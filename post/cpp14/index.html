<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>CPP14 | Yuchuan&#39;s Blog</title>

<link rel="shortcut icon" href="https://kimokcheon.github.io//favicon.ico?v=1695778991029">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://kimokcheon.github.io//styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            Yuchuan&#39;s Blog
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            首页
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            归档
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            标签
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="https://kimokcheon.github.io/post/about-me" class="menu gt-a-link">
                            关于
                        </a>
                    
                </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1695778991029" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    CPP14
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2023-06-26 ·
                    </time>
                    
                </div>
                <div class="post-content">
                    <h2 id="overview">Overview</h2>
<p>C++14 includes the following new language features:</p>
<ul>
<li><a href="#binary-literals">binary literals</a></li>
<li><a href="#generic-lambda-expressions">generic lambda expressions</a></li>
<li><a href="#lambda-capture-initializers">lambda capture initializers</a></li>
<li><a href="#return-type-deduction">return type deduction</a></li>
<li><a href="#decltypeauto">decltype(auto)</a></li>
<li><a href="#relaxing-constraints-on-constexpr-functions">relaxing constraints on constexpr functions</a></li>
<li><a href="#variable-templates">variable templates</a></li>
<li><a href="#deprecated-attribute">[[deprecated]] attribute</a></li>
</ul>
<p>C++14 includes the following new library features:</p>
<ul>
<li><a href="#user-defined-literals-for-standard-library-types">user-defined literals for standard library types</a></li>
<li><a href="#compile-time-integer-sequences">compile-time integer sequences</a></li>
<li><a href="#stdmake_unique">std::make_unique</a></li>
</ul>
<h2 id="c14-language-features">C++14 Language Features</h2>
<h3 id="binary-literals">Binary literals</h3>
<p>Binary literals provide a convenient way to represent a base-2 number.<br>
It is possible to separate digits with <code>'</code>.</p>
<pre><code class="language-c++">0b110 // == 6
0b1111'1111 // == 255
</code></pre>
<h3 id="generic-lambda-expressions">Generic lambda expressions</h3>
<p>C++14 now allows the <code>auto</code> type-specifier in the parameter list, enabling polymorphic lambdas.</p>
<pre><code class="language-c++">auto identity = [](auto x) { return x; };
int three = identity(3); // == 3
std::string foo = identity(&quot;foo&quot;); // == &quot;foo&quot;
</code></pre>
<h3 id="lambda-capture-initializers">Lambda capture initializers</h3>
<p>This allows creating lambda captures initialized with arbitrary expressions. The name given to the captured value does not need to be related to any variables in the enclosing scopes and introduces a new name inside the lambda body. The initializing expression is evaluated when the lambda is <em>created</em> (not when it is <em>invoked</em>).</p>
<pre><code class="language-c++">int factory(int i) { return i * 10; }
auto f = [x = factory(2)] { return x; }; // returns 20

auto generator = [x = 0] () mutable {
  // this would not compile without 'mutable' as we are modifying x on each call
  return x++;
};
auto a = generator(); // == 0
auto b = generator(); // == 1
auto c = generator(); // == 2
</code></pre>
<p>Because it is now possible to <em>move</em> (or <em>forward</em>) values into a lambda that could previously be only captured by copy or reference we can now capture move-only types in a lambda by value. Note that in the below example the <code>p</code> in the capture-list of <code>task2</code> on the left-hand-side of <code>=</code> is a new variable private to the lambda body and does not refer to the original <code>p</code>.</p>
<pre><code class="language-c++">auto p = std::make_unique&lt;int&gt;(1);

auto task1 = [=] { *p = 5; }; // ERROR: std::unique_ptr cannot be copied
// vs.
auto task2 = [p = std::move(p)] { *p = 5; }; // OK: p is move-constructed into the closure object
// the original p is empty after task2 is created
</code></pre>
<p>Using this reference-captures can have different names than the referenced variable.</p>
<pre><code class="language-c++">auto x = 1;
auto f = [&amp;r = x, x = x * 10] {
  ++r;
  return r + x;
};
f(); // sets x to 2 and returns 12
</code></pre>
<h3 id="return-type-deduction">Return type deduction</h3>
<p>Using an <code>auto</code> return type in C++14, the compiler will attempt to deduce the type for you. With lambdas, you can now deduce its return type using <code>auto</code>, which makes returning a deduced reference or rvalue reference possible.</p>
<pre><code class="language-c++">// Deduce return type as `int`.
auto f(int i) {
 return i;
}
</code></pre>
<pre><code class="language-c++">template &lt;typename T&gt;
auto&amp; f(T&amp; t) {
  return t;
}

// Returns a reference to a deduced type.
auto g = [](auto&amp; x) -&gt; auto&amp; { return f(x); };
int y = 123;
int&amp; z = g(y); // reference to `y`
</code></pre>
<h3 id="decltypeauto">decltype(auto)</h3>
<p>The <code>decltype(auto)</code> type-specifier also deduces a type like <code>auto</code> does. However, it deduces return types while keeping their references and cv-qualifiers, while <code>auto</code> will not.</p>
<pre><code class="language-c++">const int x = 0;
auto x1 = x; // int
decltype(auto) x2 = x; // const int
int y = 0;
int&amp; y1 = y;
auto y2 = y1; // int
decltype(auto) y3 = y1; // int&amp;
int&amp;&amp; z = 0;
auto z1 = std::move(z); // int
decltype(auto) z2 = std::move(z); // int&amp;&amp;
</code></pre>
<pre><code class="language-c++">// Note: Especially useful for generic code!

// Return type is `int`.
auto f(const int&amp; i) {
 return i;
}

// Return type is `const int&amp;`.
decltype(auto) g(const int&amp; i) {
 return i;
}

int x = 123;
static_assert(std::is_same&lt;const int&amp;, decltype(f(x))&gt;::value == 0);
static_assert(std::is_same&lt;int, decltype(f(x))&gt;::value == 1);
static_assert(std::is_same&lt;const int&amp;, decltype(g(x))&gt;::value == 1);
</code></pre>
<p>See also: <a href="README.md#decltype"><code>decltype (C++11)</code></a>.</p>
<h3 id="relaxing-constraints-on-constexpr-functions">Relaxing constraints on constexpr functions</h3>
<p>In C++11, <code>constexpr</code> function bodies could only contain a very limited set of syntaxes, including (but not limited to): <code>typedef</code>s, <code>using</code>s, and a single <code>return</code> statement. In C++14, the set of allowable syntaxes expands greatly to include the most common syntax such as <code>if</code> statements, multiple <code>return</code>s, loops, etc.</p>
<pre><code class="language-c++">constexpr int factorial(int n) {
  if (n &lt;= 1) {
    return 1;
  } else {
    return n * factorial(n - 1);
  }
}
factorial(5); // == 120
</code></pre>
<h3 id="variable-templates">Variable templates</h3>
<p>C++14 allows variables to be templated:</p>
<pre><code class="language-c++">template&lt;class T&gt;
constexpr T pi = T(3.1415926535897932385);
template&lt;class T&gt;
constexpr T e  = T(2.7182818284590452353);
</code></pre>
<h3 id="deprecated-attribute">[[deprecated]] attribute</h3>
<p>C++14 introduces the <code>[[deprecated]]</code> attribute to indicate that a unit (function, class, etc.) is discouraged and likely yield compilation warnings. If a reason is provided, it will be included in the warnings.</p>
<pre><code class="language-c++">[[deprecated]]
void old_method();
[[deprecated(&quot;Use new_method instead&quot;)]]
void legacy_method();
</code></pre>
<h2 id="c14-library-features">C++14 Library Features</h2>
<h3 id="user-defined-literals-for-standard-library-types">User-defined literals for standard library types</h3>
<p>New user-defined literals for standard library types, including new built-in literals for <code>chrono</code> and <code>basic_string</code>. These can be <code>constexpr</code> meaning they can be used at compile-time. Some uses for these literals include compile-time integer parsing, binary literals, and imaginary number literals.</p>
<pre><code class="language-c++">using namespace std::chrono_literals;
auto day = 24h;
day.count(); // == 24
std::chrono::duration_cast&lt;std::chrono::minutes&gt;(day).count(); // == 1440
</code></pre>
<h3 id="compile-time-integer-sequences">Compile-time integer sequences</h3>
<p>The class template <code>std::integer_sequence</code> represents a compile-time sequence of integers. There are a few helpers built on top:</p>
<ul>
<li><code>std::make_integer_sequence&lt;T, N&gt;</code> - creates a sequence of <code>0, ..., N - 1</code> with type <code>T</code>.</li>
<li><code>std::index_sequence_for&lt;T...&gt;</code> - converts a template parameter pack into an integer sequence.</li>
</ul>
<p>Convert an array into a tuple:</p>
<pre><code class="language-c++">template&lt;typename Array, std::size_t... I&gt;
decltype(auto) a2t_impl(const Array&amp; a, std::integer_sequence&lt;std::size_t, I...&gt;) {
  return std::make_tuple(a[I]...);
}

template&lt;typename T, std::size_t N, typename Indices = std::make_index_sequence&lt;N&gt;&gt;
decltype(auto) a2t(const std::array&lt;T, N&gt;&amp; a) {
  return a2t_impl(a, Indices());
}
</code></pre>
<h3 id="stdmake_unique">std::make_unique</h3>
<p><code>std::make_unique</code> is the recommended way to create instances of <code>std::unique_ptr</code>s due to the following reasons:</p>
<ul>
<li>Avoid having to use the <code>new</code> operator.</li>
<li>Prevents code repetition when specifying the underlying type the pointer shall hold.</li>
<li>Most importantly, it provides exception-safety. Suppose we were calling a function <code>foo</code> like so:</li>
</ul>
<pre><code class="language-c++">foo(std::unique_ptr&lt;T&gt;{new T{}}, function_that_throws(), std::unique_ptr&lt;T&gt;{new T{}});
</code></pre>
<p>The compiler is free to call <code>new T{}</code>, then <code>function_that_throws()</code>, and so on... Since we have allocated data on the heap in the first construction of a <code>T</code>, we have introduced a leak here. With <code>std::make_unique</code>, we are given exception-safety:</p>
<pre><code class="language-c++">foo(std::make_unique&lt;T&gt;(), function_that_throws(), std::make_unique&lt;T&gt;());
</code></pre>
<p>See the section on <a href="README.md#smart-pointers">smart pointers (C++11)</a> for more information on <code>std::unique_ptr</code> and <code>std::shared_ptr</code>.</p>
<h2 id="acknowledgements">Acknowledgements</h2>
<ul>
<li><a href="http://en.cppreference.com/w/cpp">cppreference</a> - especially useful for finding examples and documentation of new library features.</li>
<li><a href="http://thbecker.net/articles/rvalue_references/section_01.html">C++ Rvalue References Explained</a> - a great introduction I used to understand rvalue references, perfect forwarding, and move semantics.</li>
<li><a href="http://clang.llvm.org/cxx_status.html">clang</a> and <a href="https://gcc.gnu.org/projects/cxx-status.html">gcc</a>'s standards support pages. Also included here are the proposals for language/library features that I used to help find a description of, what it's meant to fix, and some examples.</li>
<li><a href="https://godbolt.org/">Compiler explorer</a></li>
<li><a href="https://www.amazon.com/Effective-Modern-Specific-Ways-Improve/dp/1491903996">Scott Meyers' Effective Modern C++</a> - highly recommended book!</li>
<li><a href="https://www.youtube.com/channel/UCxHAlbZQNFU2LgEtiqd2Maw">Jason Turner's C++ Weekly</a> - nice collection of C++-related videos.</li>
<li><a href="http://stackoverflow.com/questions/7027523/what-can-i-do-with-a-moved-from-object">What can I do with a moved-from object?</a></li>
<li><a href="http://stackoverflow.com/questions/24109737/what-are-some-uses-of-decltypeauto">What are some uses of decltype(auto)?</a></li>
<li>And many more SO posts I'm forgetting...</li>
</ul>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://kimokcheon.github.io/post/cpp11/" class="post-title gt-a-link">
                    CPP11
                </a>
            </div>
        

        

        

        
            <script src='https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js'></script>

<style>
	div#vcomments{
		width:100%;
		max-width: 1000px;
		padding: 2.5%
	}
</style>


	<div id="vcomments"></div>

<script>
	new Valine({
		el: '#vcomments',
		appId: '',
		appKey: '',
		avatar: '',
		pageSize: 5,
		recordIp: false,
		placeholder: 'Just Go Go',
		visitor: false,
	});
</script>

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">他们都是萤火，聚在一起就成了太阳</div>
    <div class="social-container">
        
            
                <a href="https://github.com/Kimokcheon" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
                <a href="https://www.zhihu.com/people/deng-yu-chuan-4" target="_blank">
                    <i class="fab fa-zhihu gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://kimokcheon.github.io//atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
